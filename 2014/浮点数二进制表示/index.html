<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 浮点数二进制表示 · soki</title><meta name="description" content="浮点数二进制表示 - soki"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">浮点数二进制表示</h1><div class="post-time">Dec 11, 2014</div><div class="post-content"><p>看了鸟哥博客的<a href="http://www.laruence.com/2013/03/26/2884.html" title="PHP浮点数的一个常见问题的解答" target="_blank" rel="external">一篇文章</a>后，对IEEE754浮点数表示不太明白。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">0.58</span>;</span><br><span class="line">$b = <span class="number">100</span>;</span><br><span class="line">var_dump(intval($a * $b)); <span class="comment">//输出57</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>为什么是57，这就得知道浮点数的二进制表示了称之为国际标准IEEE 754</p>
<p>在网上看了几篇文章，看了《深入理解计算机原理》2.4章浮点数之后对浮点数的二进制表示有了些理解，做下记录。</p>
<a id="more"></a>
<p><strong>二进制小数</strong><br>根据小数点符号<code>.</code>，左边是权2的正幂，右边是2的负幂<br>例如二进制小数101.11就表示<br><code>1*2^2 + 0*2^1 + 1*2^0 + 1*2^-1 + 1*2^-2</code><br><code>4 + 0 + 1 + 1/2 + 1/4 = 5 + 3/4</code></p>
<p>向左移动二进制小数点一位相当于这个数被2除<br>例如 10.111 表示为 <code>2 + 0 + 1/2 + 1/4 + 1/8</code><br>向右移动一位相当于将该数乘以2<br>例如 1011.1 表示为 <code>8 + 0 + 2 + 1 + 1/2</code></p>
<p><strong>十进制小数</strong><br>整数部分：除二取余，商继续除二直到商为0或1为止，然后倒序排列<br>小数部分：小数乘2取整，小数部分继续乘2，循环这个操作得到小数部分为0止</p>
<p>例如十进制数5.6二进制表示<br><em>整数 5</em><br>    <code>[5 / 2 = 2] 1</code><br>    <code>[2 / 2 = 1] 0</code><br>    <code>1</code><br><em>小数 0.6</em><br>    <code>［0.6 * 2 = 1.2］1，0.2</code><br>    <code>［0.2 * 2 = 0.4］0，0.4</code><br>    <code>［0.4 * 2 = 0.8］0，0.8</code><br>    <code>［0.8 * 2 = 1.6］1，0.6</code><br>    <code>［0.6 * 2 = 1.2］1，0.2</code></p>
<p>二进制为 101.10011…<br>这样下去会是一个无穷的数，那么到底取到多少位呢？</p>
<p><strong>IEEE浮点表示</strong><br>根据国际标准IEEE 754，任意一个二进制浮点数V可以表示成下面的形式：<br><code>V = (-1)^s x M x 2^E</code><br><strong>符号</strong>：(-1)^s表示符号位，s=0表示正数，s=1表示负数<br><strong>有效数</strong>：M是一个二进制小数，范围大于等于1小于2。<br><strong>指数</strong>：E是2的幂，它的作用是对浮点数加权</p>
<p>例如，十进制5.6，写成二进制小数是101.10011…（这里只取到5位小数），<code>1 ≤ M ≤ 2</code> 那么 <code>M = 1.0110011 x 2 ^ 2</code><br>那么，根据上面格式，可以得出s=0，M=1.0110011…，E=2</p>
<p><strong>标准规定</strong> 单精度浮点格式(32位)，最高1位为符号s，接下来8位为指数E，剩下23位为M<br>双精度浮点格式(64位)，<code>S=1 E=11 M=52</code></p>
<p><strong>IEEE 754对有效数M和指数E有一些特别规定</strong><br>前面说过有效数M <code>1 ≤ M ≤ 2</code>，也就是说M第1位始终是1，因此默认可以把这个1舍出，等读取的时候再把这个1加上。例如1.0110011 实际存储0110011，这样做的好处是多了一位来存放有效数。</p>
<p>E是2的幂是无符号整数，E为8位时取值范围0-255，E为11位时取值范围0-2047，科学计数法中E是可以为负的，规定在保存指数时要加上一个偏移码，读取时再通过指数减去这个偏移码。8位时为127，11位时为1023。例如2^2，假设为单精度，这时E=2，2+127=129，即10000001，读取的时候通过129-127 E=2</p>
<p>1、指数不全为0或不全为1时，就采用上面的规则<br>2、指数全为0，指数值E=1-127 (1023)，而有效数的值M，不包含隐含的开头的1。这样做是为了表示数值0的方法，表示那些非常接近于0.0的数<br>3、指数全为1，有效数全为0时，得到的值表示无穷，s=1表示负无穷，s=0表示正无穷，如果有效数不全为0，表示NaN，就是“不是一个数(Not a Number)”</p>
<p>现在把0.58写成二进制形式（单精度）<br>二进制小数为 <code>0.100101000111101011100001</code><br>有效数 <code>1.00101000111101011100001</code><br>指数 <code>-1 + 127</code></p>
<p><code>s = 0</code><br><code>E = 01111110</code><br><code>M = 00101000111101011100001</code><br>二进制表示就是 <code>0 01111110 001 0100 0111 1010 1110 0001</code></p>
<p><code>M = 00101000111101011100001</code> 转换之后等于 <code>1.15999996662139892578125</code></p>
<p><code>-1^0 * 1.15999996662139892578125 * 2^(-1) = 0.579999983310699462890625</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">0.58</span>;</span><br><span class="line">$b = <span class="number">100</span>;</span><br><span class="line">$c = $a * $b <span class="comment">// 57.99999...</span></span><br><span class="line">var_dump(intval($c)); <span class="comment">//intval后自然就等于57了</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/transfer-closed-with-outstanding-read-data-remaining/" class="prev">PREV</a><a href="/2014/AmazonAws云服务使用/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 <a href="http://haov.net">soki</a>, unless otherwise noted.</p></div></footer></div><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>