<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> soki</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link active">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><section class="container"><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/MySQL-server-has-gone-away/" class="post-title-link">MySQL server has gone away错误查找</a></h2><div class="post-time">Apr 9, 2015</div><div class="post-content"><p>在测试服务器上发现一个php守护进程异常退出，查看日志发现报了<code>Warning: PDO::prepare(): MySQL server has gone away</code> 的错误</p>
<p>一番查找发现有几种情况会出现这个错误。<br>1、MySQL服务器宕机<br>2、连接长时间没有操作，MySQL发现连接超过wait_timeout所配置的时间，MySQL就会关闭这个连接<br>可以通过命令 <code>SHOW GLOBAL VARIABLES LIKE &quot;%timeout&quot;</code> 查看 wait_timeout参数<br>3、当查询的结果集超过了max_allowed_packet设置的大小</p>
<p>MySQL服务正常第一条可以排除<br>max_allowed_packet 配置是16M，查询的数据肯定不会超过这个大小也可以排除</p>
<h3 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h3><p>php使用的是PDO操作数据库，php在脚本结束时会自动关闭连接，应该不会有超时的问题<br>出问题的正好是守护进程，通过查看代码，发现代码里有缓存PDO对象，php又是以守护进程的方式运行，连接MySQL之后并不会去关闭连接，在没有操作时连接会一直处在睡眠状态。<br>当守护进程启动后，通过 <code>SHOW PROCESSLIST</code> 可以看到状态为Sleep</p></div><a href="/2015/MySQL-server-has-gone-away/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/transfer-closed-with-outstanding-read-data-remaining/" class="post-title-link">transfer-closed-with-outstanding-read-data-remaining</a></h2><div class="post-time">Feb 13, 2015</div><div class="post-content"><p>最近有个别用户反映一直进不去游戏，卡在登录画面。经过排查发现客户端调用某接口的时候数据获取不全，通过抓包发现只要获取到一定数据量时，客户端就主动把连接关闭。客户端使用libcurl，所以我在命令行里也用curl模拟了一次请求，发现也是在获取到一定的数据后就出现 <code>transfer closed with outstanding read data remaining</code> 的错误，而且还是必现。</p>
<p>经过一翻google发现了一些可能引起错误的原因</p>
<p><strong>Expect: 100-continue</strong></p>
<blockquote>
</blockquote>
<p>当客户端要post较大的数据时，客户端会先发送一个包含 Expect: 100-continue 的头信息，询问服务器是否接受请求，如果接受，服务器返回100-continue，客户端再post数据。<br>我们post的数据才几十字节而已，这个问题基本可以忽略。</p></div><a href="/2015/transfer-closed-with-outstanding-read-data-remaining/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2014/浮点数二进制表示/" class="post-title-link">浮点数二进制表示</a></h2><div class="post-time">Dec 11, 2014</div><div class="post-content"><p>看了鸟哥博客的<a href="http://www.laruence.com/2013/03/26/2884.html" title="PHP浮点数的一个常见问题的解答">一篇文章</a>后，对IEEE754浮点数表示不太明白。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">0.58</span>;</span><br><span class="line">$b = <span class="number">100</span>;</span><br><span class="line">var_dump(intval($a * $b)); <span class="comment">//输出57</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>为什么是57，这就得知道浮点数的二进制表示了称之为国际标准IEEE 754</p>
<p>在网上看了几篇文章，看了《深入理解计算机原理》2.4章浮点数之后对浮点数的二进制表示有了些理解，做下记录。</p></div><a href="/2014/浮点数二进制表示/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2014/AmazonAws云服务使用/" class="post-title-link">AmazonAws云服务使用</a></h2><div class="post-time">Nov 17, 2014</div><div class="post-content"><p>最近项目要上google play，使用amazon aws云服务。</p>
<p>我们项目主要使用了ec2，rds，s3</p>
<p><strong>ec2服务器的登陆</strong><br>linux<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 xxx.pem</span><br><span class="line">ssh -i xxx.pem ec2-user@xxx.compute.amazonaws.com</span><br><span class="line">sudo su</span><br></pre></td></tr></table></figure></p>
<p>windows</p>
<p>推荐使用<a href="http://www.netsarang.com/products/xsh_overview.html" title="xshell">xshell</a>，xshell可以直接使用public key</p>
<p>在用户身份验证项，类型选择public key，用户名ec2-user，用户密钥就是在amazonaws生成的xxx.pem文件</p>
<p>往服务器传文件可以使用scp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -i xxx.pem test.log ec2-user@xxx.compute.amazonaws.com:/tmp</span><br></pre></td></tr></table></figure></p></div><a href="/2014/AmazonAws云服务使用/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2014/hello-world/" class="post-title-link">hello-world</a></h2><div class="post-time">Nov 17, 2014</div><div class="post-content"><p>经过一系列的折腾，博客终于在github上搭建好了。<br></div><a href="/2014/hello-world/" class="read-more">...more</a></article></li></ul></section><footer><div class="paginator"></div><div class="copyright"><p>© 2016 <a href="http://haov.net">soki</a>, unless otherwise noted.</p></div></footer></div><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>